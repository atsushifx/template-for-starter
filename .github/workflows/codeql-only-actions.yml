# src: ./.github/workflows/codeql.yml
# @(#) : GitHub Actions workflow for CodeQL security analysis
#
# This workflow performs automated security scanning using GitHub CodeQL to detect
# vulnerabilities and coding errors. It analyzes the codebase on pushes to main,
# pull requests, and weekly scheduled runs.
#
# Copyright (c) 2025 atsushifx <https://github.com/atsushifx>
#
# This software is released under the MIT License.
# https://opensource.org/licenses/MIT
#
# NOTE: For most projects, this workflow file will not need changing.
# You may wish to alter the `language` matrix below to match your repository's languages,
# or to provide custom queries or build logic.
#
name: "CodeQL Advanced"

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  schedule:
    - cron: "21 23 * * 3"

jobs:
  analyze:
    name: Analyze GitHub Actions workflows
    runs-on: "ubuntu-latest"
    permissions:
      # required for all workflows
      security-events: write

      # required to fetch internal or private CodeQL packs
      packages: read

      # only required for workflows in private repositories
      actions: read
      contents: read

    steps:
      - name: Checkout repository
        uses:
          actions/checkout@v4

          # CodeQL init ステップ（actions-workflow-scanモード）
      - name: Initialize CodeQL (GitHub Actions only)
        uses: github/codeql-action/init@v3
        with:
          languages: "actions" # ← ココが重要！
          queries: +security-extended

      # 解析実行
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3
